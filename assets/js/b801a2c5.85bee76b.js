"use strict";(self.webpackChunkarke=self.webpackChunkarke||[]).push([[9691],{3905:(e,n,t)=>{t.d(n,{Zo:()=>l,kt:()=>k});var r=t(67294);function o(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function a(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,r)}return t}function i(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?a(Object(t),!0).forEach((function(n){o(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):a(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function s(e,n){if(null==e)return{};var t,r,o=function(e,n){if(null==e)return{};var t,r,o={},a=Object.keys(e);for(r=0;r<a.length;r++)t=a[r],n.indexOf(t)>=0||(o[t]=e[t]);return o}(e,n);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)t=a[r],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(o[t]=e[t])}return o}var u=r.createContext({}),d=function(e){var n=r.useContext(u),t=n;return e&&(t="function"==typeof e?e(n):i(i({},n),e)),t},l=function(e){var n=d(e.components);return r.createElement(u.Provider,{value:n},e.children)},c={inlineCode:"code",wrapper:function(e){var n=e.children;return r.createElement(r.Fragment,{},n)}},p=r.forwardRef((function(e,n){var t=e.components,o=e.mdxType,a=e.originalType,u=e.parentName,l=s(e,["components","mdxType","originalType","parentName"]),p=d(t),k=o,m=p["".concat(u,".").concat(k)]||p[k]||c[k]||a;return t?r.createElement(m,i(i({ref:n},l),{},{components:t})):r.createElement(m,i({ref:n},l))}));function k(e,n){var t=arguments,o=n&&n.mdxType;if("string"==typeof e||o){var a=t.length,i=new Array(a);i[0]=p;var s={};for(var u in n)hasOwnProperty.call(n,u)&&(s[u]=n[u]);s.originalType=e,s.mdxType="string"==typeof e?e:o,i[1]=s;for(var d=2;d<a;d++)i[d]=t[d];return r.createElement.apply(null,i)}return r.createElement.apply(null,t)}p.displayName="MDXCreateElement"},3103:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>u,contentTitle:()=>i,default:()=>c,frontMatter:()=>a,metadata:()=>s,toc:()=>d});var r=t(87462),o=(t(67294),t(3905));const a={id:"crud",title:"CRUD"},i=void 0,s={unversionedId:"frontend/crud",id:"frontend/crud",title:"CRUD",description:"This guide talks about setting a Crud page through Arke.",source:"@site/reference/frontend/crud.md",sourceDirName:"frontend",slug:"/frontend/crud",permalink:"/docs/frontend/crud",draft:!1,editUrl:"https://github.com/arkemishub/arke-docs/reference/frontend/crud.md",tags:[],version:"current",frontMatter:{id:"crud",title:"CRUD"},sidebar:"docsSidebar",previous:{title:"Refresh token",permalink:"/docs/backend/rest/refresh-tokens"},next:{title:"Using Docker",permalink:"/docs/deployment/using-docker"}},u={},d=[{value:"Init CRUD",id:"init-crud",level:2},{value:"Step 1: Create a CRUD state",id:"step-1-create-a-crud-state",level:3},{value:"Step 2: Create a useStruct hook",id:"step-2-create-a-usestruct-hook",level:3},{value:"Step 3: Create a useCrud hook",id:"step-3-create-a-usecrud-hook",level:3},{value:"Step 4: Create/Edit CrudComponent",id:"step-4-createedit-crudcomponent",level:3},{value:"Step 6: Delete CrudComponent",id:"step-6-delete-crudcomponent",level:3},{value:"Step 7: Compose CRUD on your page",id:"step-7-compose-crud-on-your-page",level:3},{value:"Advanced: Link after creation",id:"advanced-link-after-creation",level:2},{value:"Step 1: useLink and useUnlink",id:"step-1-uselink-and-useunlink",level:3},{value:"Step 2: Consume link hooks",id:"step-2-consume-link-hooks",level:3}],l={toc:d};function c(e){let{components:n,...t}=e;return(0,o.kt)("wrapper",(0,r.Z)({},l,t,{components:n,mdxType:"MDXLayout"}),(0,o.kt)("p",null,"This guide talks about setting a Crud page through Arke."),(0,o.kt)("h2",{id:"init-crud"},"Init CRUD"),(0,o.kt)("h3",{id:"step-1-create-a-crud-state"},"Step 1: Create a CRUD state"),(0,o.kt)("p",null,"Create a dedicated state to manage your CRUD:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-tsx"},"type ID = string;\nexport interface CrudState {\n    add?: boolean;\n    edit?: boolean | ID;\n    delete?: boolean | ID;\n}\n\nexport default function Page() {\n    const [crud, setCrud] = useState<CrudState>({\n        add: false,\n        edit: false,\n        delete: false,\n    })\n\n    return (\n        <div>\n            ...\n        </div>\n    )\n}\n")),(0,o.kt)("h3",{id:"step-2-create-a-usestruct-hook"},"Step 2: Create a useStruct hook"),(0,o.kt)("p",null,"With useStruct hook you can simplify the retrieval data and get the fields list:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-tsx"},"import { useEffect, useState } from 'react';\nimport useClient from '@/arke/useClient';\nimport { Field } from '@arkejs/form';\n\nexport default function useStruct(\n  arke: string,\n  unit: string | undefined,\n  open: boolean\n) {\n  const client = useClient();\n  const exclude = ['id', 'arke_id'];\n  const [loading, setLoading] = useState<boolean>(true);\n  const [fields, setFields] = useState<Field[]>([]);\n\n  useEffect(() => {\n    if (open) {\n      setLoading(true);\n      const getStruct = () =>\n        unit\n          ? client.unit.struct(arke, unit, {\n              params: { exclude },\n            })\n          : client.arke.struct(arke, {\n              params: { exclude },\n            });\n\n      getStruct()\n        .then((res) => setFields(res.data.content.parameters))\n        .catch((e) => console.error(e))\n        .finally(() => setLoading(false));\n    }\n  }, [open]);\n\n  return { fields, loading };\n}\n")),(0,o.kt)("h3",{id:"step-3-create-a-usecrud-hook"},"Step 3: Create a useCrud hook"),(0,o.kt)("p",null,"Create a global ",(0,o.kt)("inlineCode",{parentName:"p"},"useCrud")," hook to simply manage the create/edit API call on your CRUDs just passing arke,\nunit and callback params;"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-tsx"},"import { getClient } from '@arke/getClient';\nimport { TResponse, TUnit } from '@arkejs/client';\n\nexport default function useCrud(\n    arke: string,\n    unit: string | undefined,\n    callback: (data: TResponse<TUnit>) => void\n) {\n    const client = useClient();\n    function onSubmit(data: Record<string, unknown>) {\n        const promise = !unit\n            ? client.unit.create(arke, data)\n            : client.unit.edit(arke, unit as string, data);\n        promise.then(\n            (res) => callback(res),\n            (err) =>\n                err.response.data.messages.forEach((item: { message: string }) =>\n                    toast.error(item.message)\n                )\n        );\n    }\n    return { onSubmit };\n}\n")),(0,o.kt)("h3",{id:"step-4-createedit-crudcomponent"},"Step 4: Create/Edit CrudComponent"),(0,o.kt)("p",null,"Create a CrudComponent that will be used as Dialog/Drawer form to create/edit your Arke or Unit."),(0,o.kt)("p",null,"For example if you have to manage ",(0,o.kt)("inlineCode",{parentName:"p"},"Products")," units, you can name it ",(0,o.kt)("inlineCode",{parentName:"p"},"ProductCrud"),"."),(0,o.kt)("p",null,"Import your useStruct and useCrud hook on CrudComponent, this will provide the ",(0,o.kt)("inlineCode",{parentName:"p"},"onSubmit")," that you can\nuse on your Form."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-tsx"},"export function ProductCrud(props: CrudProps) {\n  const client = useClient();\n  const { open, title, id, onClose } = props;\n  const { fields, loading } = useStruct(arke, id, open as boolean);\n  const { onSubmit } = useCrud('product', id, props.onSubmit);\n    \n  return (\n    <Dialog open={!!open} title={title} onClose={onClose}>\n      <Form\n        fields={fields}\n        onSubmit={onSubmit}\n      >\n        {() =>\n          loading ? (\n            <Loader />\n          ) : (\n            <>\n              <Container>\n                <FormField\n                  id={'image'}\n                  render={(props) => <ProductImage {...props} />}\n                />\n                <FormField id={'name'} />\n                <FormField id={'slug'} />\n                <FormField id={'product_type'} />\n                <FormField id={'price'} />\n                <FormField id={'description'} />\n              </Container>\n              <Action>\n                <Button disabled={loading} variant=\"outlined\" onClick={onClose}>\n                  Annulla\n                </Button>\n                <Button disabled={loading} variant=\"contained\" type=\"submit\">\n                  Conferma\n                </Button>\n              </Action>\n            </>\n          )\n        }\n      </Form>\n    </Dialog>\n  );\n}\n")),(0,o.kt)("h3",{id:"step-6-delete-crudcomponent"},"Step 6: Delete CrudComponent"),(0,o.kt)("p",null,"Create and export a ",(0,o.kt)("inlineCode",{parentName:"p"},"Delete")," component from ComponentCrud:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-tsx"},'function Delete(props: DeleteProps) {\n  const client = useClient();\n  const { arke, id, open, title, onClose, onSubmit } = props;\n\n  function onDelete() {\n      client.unit.delete(arke, id as string).then((res) => {\n        onSubmit(res);\n      });\n  }\n\n  return (\n    <Dialog open={!!open} title={title} onClose={onClose}>\n      <Container>\n        <p className="text-sm">Sei sicuro di voler continuare?</p>\n      </Container>\n      <Action>\n        <Button variant="outlined" onClick={onClose}>\n          Annulla\n        </Button>\n        <Button variant="contained" onClick={onDelete}>\n          Conferma\n        </Button>\n      </Action>\n    </Dialog>\n  );\n}\n')),(0,o.kt)("h3",{id:"step-7-compose-crud-on-your-page"},"Step 7: Compose CRUD on your page"),(0,o.kt)("p",null,"Import your CrudComponent on your page and connect the state variables:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-tsx"},'import {\n    ProductCrud as ProductAdd,\n    ProductCrud as ProductEdit,\n    Delete as ProductDelete,\n} from \'@crud/products/ProductCrud\';\n\nexport default function Products() {\n    const [crud, setCrud] = useState<CrudState>({\n        add: false,\n        edit: false,\n        delete: false,\n    });\n    \n    <Button onClick={setCrud((p) => ({ ...p, add: false }))}>Add</Button>\n    <Button onClick={setCrud((p) => ({ ...p, edit: false }))}>Edit</Button>\n    <Button onClick={setCrud((p) => ({ ...p, delete: false }))}>Delete</Button>\n\n    <ProductAdd\n        title="Aggiungi prodotto"\n        open={crud.add}\n        onClose={() => setCrud((p) => ({ ...p, add: false }))}\n        onSubmit={() => {\n            toast.success(`Prodotto aggiunta con successo`);\n            setCrud((p) => ({ ...p, add: false }));\n        }}\n    />\n    <ProductEdit\n        title="Modifica prodotto"\n        open={crud.edit}\n        id={crud.edit as string}\n        onClose={() => setCrud((p) => ({ ...p, edit: false }))}\n        onSubmit={() => {\n            toast.success(`Prodotto modificata con successo`);\n            setCrud((p) => ({ ...p, edit: false }));\n        }}\n    />\n    <ProductDelete\n        arke="product"\n        title="Elimina prodotto"\n        open={crud.delete}\n        id={crud.delete as string}\n        onClose={() => setCrud((p) => ({ ...p, delete: false }))}\n        onSubmit={() => {\n            toast.success(`Prodotto eliminata con successo`);\n            setCrud((p) => ({ ...p, delete: false }));\n        }}\n    />\n}\n')),(0,o.kt)("p",null,"Repeat these steps for all CRUDs present in your application."),(0,o.kt)("admonition",{type:"tip"},(0,o.kt)("p",{parentName:"admonition"},"You can generate a global and generalized components for all CRUDs")),(0,o.kt)("h2",{id:"advanced-link-after-creation"},"Advanced: Link after creation"),(0,o.kt)("p",null,"In some cases on the unit creation process, it necessary ",(0,o.kt)("inlineCode",{parentName:"p"},"Link")," your unit to another one."),(0,o.kt)("h3",{id:"step-1-uselink-and-useunlink"},"Step 1: useLink and useUnlink"),(0,o.kt)("p",null,"Create the ",(0,o.kt)("inlineCode",{parentName:"p"},"useLink")," and ",(0,o.kt)("inlineCode",{parentName:"p"},"useUnlink")," hooks, that will used after the creation process."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-tsx"},"import { useClient } from '@hooks';\n\nexport function useLink(\n  arkeParent: string,\n  unitParent: string | string[] | undefined,\n  arkeChild: string,\n  callback?: () => void\n) {\n  const client = useClient();\n  function onLink(unitChild: string) {\n    return client.api\n      .post(\n        `/${arkeParent}/unit/${unitParent}/link/link/${arkeChild}/unit/${unitChild}`\n      )\n      .then(callback)\n      .catch((err: string) => console.error(err));\n  }\n  return { onLink };\n}\n\nexport function useUnlink(\n  arkeParent: string,\n  unitParent: string | string[] | undefined,\n  arkeChild: string,\n  callback?: () => void\n) {\n  const client = useClient();\n  function onUnlink(unitChild: string) {\n    return client.api\n      .delete(\n        `/${arkeParent}/unit/${unitParent}/link/link/${arkeChild}/unit/${unitChild}`\n      )\n      .then(callback)\n      .catch((err: string) => console.error(err));\n  }\n  return { onUnlink };\n}\n")),(0,o.kt)("h3",{id:"step-2-consume-link-hooks"},"Step 2: Consume link hooks"),(0,o.kt)("p",null,"Use useLink and useUnlink on your CRUD page:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-tsx"},"import {\n    ProductCrud as ProductAdd,\n    ProductCrud as ProductEdit,\n    Delete as ProductDelete,\n} from '@crud/products/ProductCrud';\n\nexport default function Products() {\n    const [crud, setCrud] = useState<CrudState>({\n        add: false,\n        edit: false,\n        delete: false,\n    });\n\n    // Link new product [child] to category [parent]\n    const { onLink } = useLink('category', id, 'product', () => {\n        toast.success(`Coworker aggiunto con successo`);\n        setCrud((p) => ({ ...p, add: false }));\n    });\n    const { onUnlink } = useUnlink('category', id, 'product');\n\n    <Button onClick={setCrud((p) => ({ ...p, add: false }))}>Add</Button>\n    <Button onClick={setCrud((p) => ({ ...p, edit: false }))}>Edit</Button>\n    <Button onClick={setCrud((p) => ({ ...p, delete: false }))}>Delete</Button>\n\n    <ProductAdd\n        title=\"Aggiungi prodotto\"\n        open={crud.add}\n        onClose={() => setCrud((p) => ({ ...p, add: false }))}\n        // Pass the id of the new product to onLink method\n        onSubmit={(res) => onLink(res.data.content.id)}\n    />\n    <ProductEdit\n        title=\"Modifica prodotto\"\n        open={crud.edit}\n        id={crud.edit as string}\n        onClose={() => setCrud((p) => ({ ...p, edit: false }))}\n        onSubmit={() => {\n            toast.success(`Prodotto modificata con successo`);\n            setCrud((p) => ({ ...p, edit: false }));\n        }}\n    />\n    <ProductDelete\n        arke=\"product\"\n        title=\"Elimina prodotto\"\n        open={crud.delete}\n        id={crud.delete as string}\n        onClose={() => setCrud((p) => ({ ...p, delete: false }))}\n        // Before delete unlink the selected product\n        onBeforeSubmit={() => onUnlink(crud.delete as string)}\n        onSubmit={() => {\n            toast.success(`Prodotto eliminata con successo`);\n            setCrud((p) => ({ ...p, delete: false }));\n        }}\n    />\n}\n")))}c.isMDXComponent=!0}}]);