"use strict";(self.webpackChunkarke=self.webpackChunkarke||[]).push([[9556],{81649:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>d,contentTitle:()=>i,default:()=>c,frontMatter:()=>a,metadata:()=>s,toc:()=>u});var o=t(87462),r=(t(67294),t(3905));const a={id:"crud",title:"CRUD"},i=void 0,s={unversionedId:"web/crud",id:"web/crud",title:"CRUD",description:"This guide talks about setting a Crud page through Arke.",source:"@site/reference/web/crud.md",sourceDirName:"web",slug:"/web/crud",permalink:"/docs/web/crud",draft:!1,editUrl:"https://github.com/arkemishub/arke-docs/reference/web/crud.md",tags:[],version:"current",frontMatter:{id:"crud",title:"CRUD"},sidebar:"docsSidebar",previous:{title:"Storage",permalink:"/docs/server/storage"},next:{title:"Arke CLI",permalink:"/docs/cli/intro"}},d={},u=[{value:"Init CRUD",id:"init-crud",level:2},{value:"Step 1: Create a CRUD state",id:"step-1-create-a-crud-state",level:3},{value:"Step 2: Create a useStruct hook",id:"step-2-create-a-usestruct-hook",level:3},{value:"Step 3: Create a useCrud hook",id:"step-3-create-a-usecrud-hook",level:3},{value:"Step 4: Create/Edit CrudComponent",id:"step-4-createedit-crudcomponent",level:3},{value:"Step 6: Delete CrudComponent",id:"step-6-delete-crudcomponent",level:3},{value:"Step 7: Compose CRUD on your page",id:"step-7-compose-crud-on-your-page",level:3},{value:"Advanced: Link after creation",id:"advanced-link-after-creation",level:2},{value:"Step 1: useLink and useUnlink",id:"step-1-uselink-and-useunlink",level:3},{value:"Step 2: Consume link hooks",id:"step-2-consume-link-hooks",level:3}],l={toc:u};function c(e){let{components:n,...t}=e;return(0,r.kt)("wrapper",(0,o.Z)({},l,t,{components:n,mdxType:"MDXLayout"}),(0,r.kt)("p",null,"This guide talks about setting a Crud page through Arke."),(0,r.kt)("h2",{id:"init-crud"},"Init CRUD"),(0,r.kt)("h3",{id:"step-1-create-a-crud-state"},"Step 1: Create a CRUD state"),(0,r.kt)("p",null,"Create a dedicated state to manage your CRUD:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-tsx"},"type ID = string;\nexport interface CrudState {\n    add?: boolean;\n    edit?: boolean | ID;\n    delete?: boolean | ID;\n}\n\nexport default function Page() {\n    const [crud, setCrud] = useState<CrudState>({\n        add: false,\n        edit: false,\n        delete: false,\n    })\n\n    return (\n        <div>\n            ...\n        </div>\n    )\n}\n")),(0,r.kt)("h3",{id:"step-2-create-a-usestruct-hook"},"Step 2: Create a useStruct hook"),(0,r.kt)("p",null,"With useStruct hook you can simplify the retrieval data and get the fields list:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-tsx"},"import { useEffect, useState } from 'react';\nimport useClient from '@/arke/useClient';\nimport { Field } from '@arkejs/form';\n\nexport default function useStruct(\n  arke: string,\n  unit: string | undefined,\n  open: boolean\n) {\n  const client = useClient();\n  const exclude = ['id', 'arke_id'];\n  const [loading, setLoading] = useState<boolean>(true);\n  const [fields, setFields] = useState<Field[]>([]);\n\n  useEffect(() => {\n    if (open) {\n      setLoading(true);\n      const getStruct = () =>\n        unit\n          ? client.unit.struct(arke, unit, {\n              params: { exclude },\n            })\n          : client.arke.struct(arke, {\n              params: { exclude },\n            });\n\n      getStruct()\n        .then((res) => setFields(res.data.content.parameters))\n        .catch((e) => console.error(e))\n        .finally(() => setLoading(false));\n    }\n  }, [open]);\n\n  return { fields, loading };\n}\n")),(0,r.kt)("h3",{id:"step-3-create-a-usecrud-hook"},"Step 3: Create a useCrud hook"),(0,r.kt)("p",null,"Create a global ",(0,r.kt)("inlineCode",{parentName:"p"},"useCrud")," hook to simply manage the create/edit API call on your CRUDs just passing arke,\nunit and callback params;"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-tsx"},"import { getClient } from '@arke/getClient';\nimport { TResponse, TUnit } from '@arkejs/client';\n\nexport default function useCrud(\n    arke: string,\n    unit: string | undefined,\n    callback: (data: TResponse<TUnit>) => void\n) {\n    const client = useClient();\n    function onSubmit(data: Record<string, unknown>) {\n        const promise = !unit\n            ? client.unit.create(arke, data)\n            : client.unit.edit(arke, unit as string, data);\n        promise.then(\n            (res) => callback(res),\n            (err) =>\n                err.response.data.messages.forEach((item: { message: string }) =>\n                    toast.error(item.message)\n                )\n        );\n    }\n    return { onSubmit };\n}\n")),(0,r.kt)("h3",{id:"step-4-createedit-crudcomponent"},"Step 4: Create/Edit CrudComponent"),(0,r.kt)("p",null,"Create a CrudComponent that will be used as Dialog/Drawer form to create/edit your Arke or Unit."),(0,r.kt)("p",null,"For example if you have to manage ",(0,r.kt)("inlineCode",{parentName:"p"},"Products")," units, you can name it ",(0,r.kt)("inlineCode",{parentName:"p"},"ProductCrud"),"."),(0,r.kt)("p",null,"Import your useStruct and useCrud hook on CrudComponent, this will provide the ",(0,r.kt)("inlineCode",{parentName:"p"},"onSubmit")," that you can\nuse on your Form."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-tsx"},"export function ProductCrud(props: CrudProps) {\n  const client = useClient();\n  const { open, title, id, onClose } = props;\n  const { fields, loading } = useStruct(arke, id, open as boolean);\n  const { onSubmit } = useCrud('product', id, props.onSubmit);\n    \n  return (\n    <Dialog open={!!open} title={title} onClose={onClose}>\n      <Form\n        fields={fields}\n        onSubmit={onSubmit}\n      >\n        {() =>\n          loading ? (\n            <Loader />\n          ) : (\n            <>\n              <Container>\n                <FormField\n                  id={'image'}\n                  render={(props) => <ProductImage {...props} />}\n                />\n                <FormField id={'name'} />\n                <FormField id={'slug'} />\n                <FormField id={'product_type'} />\n                <FormField id={'price'} />\n                <FormField id={'description'} />\n              </Container>\n              <Action>\n                <Button disabled={loading} variant=\"outlined\" onClick={onClose}>\n                  Annulla\n                </Button>\n                <Button disabled={loading} variant=\"contained\" type=\"submit\">\n                  Conferma\n                </Button>\n              </Action>\n            </>\n          )\n        }\n      </Form>\n    </Dialog>\n  );\n}\n")),(0,r.kt)("h3",{id:"step-6-delete-crudcomponent"},"Step 6: Delete CrudComponent"),(0,r.kt)("p",null,"Create and export a ",(0,r.kt)("inlineCode",{parentName:"p"},"Delete")," component from ComponentCrud:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-tsx"},'function Delete(props: DeleteProps) {\n  const client = useClient();\n  const { arke, id, open, title, onClose, onSubmit } = props;\n\n  function onDelete() {\n      client.unit.delete(arke, id as string).then((res) => {\n        onSubmit(res);\n      });\n  }\n\n  return (\n    <Dialog open={!!open} title={title} onClose={onClose}>\n      <Container>\n        <p className="text-sm">Sei sicuro di voler continuare?</p>\n      </Container>\n      <Action>\n        <Button variant="outlined" onClick={onClose}>\n          Annulla\n        </Button>\n        <Button variant="contained" onClick={onDelete}>\n          Conferma\n        </Button>\n      </Action>\n    </Dialog>\n  );\n}\n')),(0,r.kt)("h3",{id:"step-7-compose-crud-on-your-page"},"Step 7: Compose CRUD on your page"),(0,r.kt)("p",null,"Import your CrudComponent on your page and connect the state variables:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-tsx"},'import {\n    ProductCrud as ProductAdd,\n    ProductCrud as ProductEdit,\n    Delete as ProductDelete,\n} from \'@crud/products/ProductCrud\';\n\nexport default function Products() {\n    const [crud, setCrud] = useState<CrudState>({\n        add: false,\n        edit: false,\n        delete: false,\n    });\n    \n    <Button onClick={setCrud((p) => ({ ...p, add: false }))}>Add</Button>\n    <Button onClick={setCrud((p) => ({ ...p, edit: false }))}>Edit</Button>\n    <Button onClick={setCrud((p) => ({ ...p, delete: false }))}>Delete</Button>\n\n    <ProductAdd\n        title="Aggiungi prodotto"\n        open={crud.add}\n        onClose={() => setCrud((p) => ({ ...p, add: false }))}\n        onSubmit={() => {\n            toast.success(`Prodotto aggiunta con successo`);\n            setCrud((p) => ({ ...p, add: false }));\n        }}\n    />\n    <ProductEdit\n        title="Modifica prodotto"\n        open={crud.edit}\n        id={crud.edit as string}\n        onClose={() => setCrud((p) => ({ ...p, edit: false }))}\n        onSubmit={() => {\n            toast.success(`Prodotto modificata con successo`);\n            setCrud((p) => ({ ...p, edit: false }));\n        }}\n    />\n    <ProductDelete\n        arke="product"\n        title="Elimina prodotto"\n        open={crud.delete}\n        id={crud.delete as string}\n        onClose={() => setCrud((p) => ({ ...p, delete: false }))}\n        onSubmit={() => {\n            toast.success(`Prodotto eliminata con successo`);\n            setCrud((p) => ({ ...p, delete: false }));\n        }}\n    />\n}\n')),(0,r.kt)("p",null,"Repeat these steps for all CRUDs present in your application."),(0,r.kt)("admonition",{type:"tip"},(0,r.kt)("p",{parentName:"admonition"},"You can generate a global and generalized components for all CRUDs")),(0,r.kt)("h2",{id:"advanced-link-after-creation"},"Advanced: Link after creation"),(0,r.kt)("p",null,"In some cases on the unit creation process, it necessary ",(0,r.kt)("inlineCode",{parentName:"p"},"Link")," your unit to another one."),(0,r.kt)("h3",{id:"step-1-uselink-and-useunlink"},"Step 1: useLink and useUnlink"),(0,r.kt)("p",null,"Create the ",(0,r.kt)("inlineCode",{parentName:"p"},"useLink")," and ",(0,r.kt)("inlineCode",{parentName:"p"},"useUnlink")," hooks, that will used after the creation process."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-tsx"},"import { useClient } from '@hooks';\n\nexport function useLink(\n  arkeParent: string,\n  unitParent: string | string[] | undefined,\n  arkeChild: string,\n  callback?: () => void\n) {\n  const client = useClient();\n  function onLink(unitChild: string) {\n    return client.api\n      .post(\n        `/${arkeParent}/unit/${unitParent}/link/link/${arkeChild}/unit/${unitChild}`\n      )\n      .then(callback)\n      .catch((err: string) => console.error(err));\n  }\n  return { onLink };\n}\n\nexport function useUnlink(\n  arkeParent: string,\n  unitParent: string | string[] | undefined,\n  arkeChild: string,\n  callback?: () => void\n) {\n  const client = useClient();\n  function onUnlink(unitChild: string) {\n    return client.api\n      .delete(\n        `/${arkeParent}/unit/${unitParent}/link/link/${arkeChild}/unit/${unitChild}`\n      )\n      .then(callback)\n      .catch((err: string) => console.error(err));\n  }\n  return { onUnlink };\n}\n")),(0,r.kt)("h3",{id:"step-2-consume-link-hooks"},"Step 2: Consume link hooks"),(0,r.kt)("p",null,"Use useLink and useUnlink on your CRUD page:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-tsx"},"import {\n    ProductCrud as ProductAdd,\n    ProductCrud as ProductEdit,\n    Delete as ProductDelete,\n} from '@crud/products/ProductCrud';\n\nexport default function Products() {\n    const [crud, setCrud] = useState<CrudState>({\n        add: false,\n        edit: false,\n        delete: false,\n    });\n\n    // Link new product [child] to category [parent]\n    const { onLink } = useLink('category', id, 'product', () => {\n        toast.success(`Coworker aggiunto con successo`);\n        setCrud((p) => ({ ...p, add: false }));\n    });\n    const { onUnlink } = useUnlink('category', id, 'product');\n\n    <Button onClick={setCrud((p) => ({ ...p, add: false }))}>Add</Button>\n    <Button onClick={setCrud((p) => ({ ...p, edit: false }))}>Edit</Button>\n    <Button onClick={setCrud((p) => ({ ...p, delete: false }))}>Delete</Button>\n\n    <ProductAdd\n        title=\"Aggiungi prodotto\"\n        open={crud.add}\n        onClose={() => setCrud((p) => ({ ...p, add: false }))}\n        // Pass the id of the new product to onLink method\n        onSubmit={(res) => onLink(res.data.content.id)}\n    />\n    <ProductEdit\n        title=\"Modifica prodotto\"\n        open={crud.edit}\n        id={crud.edit as string}\n        onClose={() => setCrud((p) => ({ ...p, edit: false }))}\n        onSubmit={() => {\n            toast.success(`Prodotto modificata con successo`);\n            setCrud((p) => ({ ...p, edit: false }));\n        }}\n    />\n    <ProductDelete\n        arke=\"product\"\n        title=\"Elimina prodotto\"\n        open={crud.delete}\n        id={crud.delete as string}\n        onClose={() => setCrud((p) => ({ ...p, delete: false }))}\n        // Before delete unlink the selected product\n        onBeforeSubmit={() => onUnlink(crud.delete as string)}\n        onSubmit={() => {\n            toast.success(`Prodotto eliminata con successo`);\n            setCrud((p) => ({ ...p, delete: false }));\n        }}\n    />\n}\n")))}c.isMDXComponent=!0}}]);